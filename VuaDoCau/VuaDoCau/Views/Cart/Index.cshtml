@model VuaDoCau.Controllers.CartController.CartVM
@{
    ViewData["Title"] = "Giỏ hàng";
    string VND(decimal v) => $"{v:N0} đ";
}

<div class="container py-4">
    <h1 class="mb-3">Giỏ hàng</h1>

    @if (TempData["CartMessage"] is string msg)
    {
        <div class="alert alert-success">@msg</div>
    }

    @if (Model.Items == null || !Model.Items.Any())
    {
        <div class="alert alert-info">Giỏ hàng của bạn đang trống.</div>
        <a asp-controller="Products" asp-action="Index" class="btn btn-primary">Tiếp tục mua sắm</a>
    }
    else
    {
        <div class="table-responsive mb-3">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th style="width:80px;"></th>
                        <th>Sản phẩm</th>
                        <th class="text-end">Giá</th>
                        <th class="text-center" style="width:160px;">Số lượng</th>
                        <th class="text-end">Tạm tính</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var it in Model.Items)
                    {
                        <tr>
                            <td>
                                <img src="@it.ImageUrl" alt="@it.Name" style="width:64px;height:64px;object-fit:cover;border-radius:8px;background:#f3f4f6;" />
                            </td>
                            <td class="fw-semibold">@it.Name</td>
                            <td class="text-end">@VND(it.UnitPrice)</td>
                            <td class="text-center">
                                <form asp-controller="Cart" asp-action="Update" method="post" class="d-inline-flex align-items-center gap-2">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="productId" value="@it.ProductId" />
                                    <input type="number" name="quantity" value="@it.Quantity" min="1" class="form-control qty-input" />
                                    <button type="submit" class="btn btn-outline-secondary btn-sm">Áp dụng</button>
                                </form>
                            </td>
                            <td class="text-end fw-bold">@VND(it.Subtotal)</td>
                            <td class="text-end">
                                <form asp-controller="Cart" asp-action="Remove" method="post" onsubmit="return confirm('Xóa sản phẩm này?');">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="productId" value="@it.ProductId" />
                                    <button class="btn btn-link text-danger">✕</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
                <tfoot class="table-light">
                    <tr>
                        <th colspan="4" class="text-end">Tạm tính</th>
                        <th class="text-end">@VND(Model.Subtotal)</th>
                        <th></th>
                    </tr>
                    <tr>
                        <th colspan="4" class="text-end">Phí ship</th>
                        <th class="text-end">@VND(Model.Shipping)</th>
                        <th></th>
                    </tr>
                    <tr>
                        <th colspan="4" class="text-end fs-5">Tổng cộng</th>
                        <th class="text-end fs-5">@VND(Model.Total)</th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="d-flex gap-2 justify-content-between">
            <form asp-controller="Cart" asp-action="Clear" method="post" onsubmit="return confirm('Xóa toàn bộ giỏ hàng?');">
                @Html.AntiForgeryToken()
                <button class="btn btn-outline-danger">Xóa toàn bộ</button>
            </form>

            <div class="d-flex gap-2">
                <a asp-controller="Products" asp-action="Index" class="btn btn-outline-secondary">Tiếp tục mua sắm</a>
                <a asp-controller="Orders" asp-action="Create" class="btn btn-primary">Thanh toán</a>
            </div>
        </div>
    }
</div>
