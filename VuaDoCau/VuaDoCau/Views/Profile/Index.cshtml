@using System.Globalization
@model VuaDoCau.Models.ProfileViewModel
@{
    ViewData["Title"] = "Hồ sơ cá nhân";
    var vi = new CultureInfo("vi-VN");
}

<h2 class="mb-4">Hồ sơ cá nhân</h2>

<div class="card mb-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>Họ tên:</strong> @Model.FullName</p>
                <p><strong>SĐT:</strong> @Model.Phone</p>
            </div>
            <div class="col-md-6">
                <p><strong>Email:</strong> @Model.Email</p>
                <p><strong>Địa chỉ:</strong> @Model.Address</p>
            </div>
        </div>
    </div>
</div>

<h3 class="mb-3">Lịch sử đơn hàng</h3>

<table class="table table-hover align-middle">
    <thead>
        <tr>
            <th style="width:140px">Mã đơn</th>
            <th style="width:220px">Ngày</th>
            <th>Trạng thái</th>
            <th class="text-end" style="width:160px">Tổng</th>
        </tr>
    </thead>
    <tbody>
        @if (Model.Orders?.Any() == true)
        {
            foreach (var order in Model.Orders)
            {
                <tr class="table-active">
                    <td>#@order.Id</td>
                    <td>@order.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                    <td>@order.StatusText</td>
                    <td class="text-end">@String.Format(vi, "{0:N0} đ", order.Total)</td>
                </tr>

                @if (order.Items?.Any() == true)
                {
                    foreach (var it in order.Items)
                    {
                        var lineTotal = it.UnitPrice * it.Quantity;
                        <tr>
                            <td colspan="3" class="ps-4">@it.ProductName × @it.Quantity</td>
                            <td class="text-end">@String.Format(vi, "{0:N0} đ", lineTotal)</td>
                        </tr>
                    }
                }
            }
        }
        else
        {
            <tr><td colspan="4" class="text-center text-muted">Chưa có đơn hàng.</td></tr>
        }
    </tbody>
</table>
