@using VuaDoCau.Models
@model IEnumerable<Category>

@{
    ViewData["Title"] = "Trang chủ";
    string VND(decimal v) => $"{v:N0} đ";
}

<style>
    .home-section {
        margin-bottom: 2.5rem;
    }

    .home-head {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: .75rem;
    }

        .home-head .tag {
            background: #0d6efd;
            color: #fff;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 700;
        }

        .home-head .rule {
            flex: 1;
            height: 2px;
            background: #e9ecef;
        }

    .grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 14px;
    }

    @@media (max-width: 1200px) {
        .grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    @@media (max-width: 992px) {
        .grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @@media (max-width: 768px) {
        .grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .card {
        border: 1px solid #e9ecef;
        border-radius: 10px;
        overflow: hidden;
        background: #fff;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .thumb {
        aspect-ratio: 1 / 1;
        width: 100%;
        object-fit: cover;
        background: #f3f4f6;
    }

    .body {
        padding: 10px 12px;
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .title {
        font-weight: 600;
        min-height: 44px;
        line-height: 1.2;
    }

    .price {
        font-weight: 700;
    }

    .actions {
        margin-top: auto;
        display: flex;
        gap: 8px;
    }

        .actions .btn {
            flex: 1;
        }
</style>

<div class="container py-4">
    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-info">Chưa có danh mục/sản phẩm để hiển thị.</div>
    }
    else
    {
        foreach (var cat in Model)
        {
            <section class="home-section">
                <div class="home-head">
                    <div class="tag">@cat.Name</div>
                    <div class="rule"></div>
                </div>

                <div class="grid">
                    @foreach (var p in (cat.Products ?? new List<Product>()).OrderByDescending(x => x.Id).Take(5))
                    {
                        var img = string.IsNullOrWhiteSpace(p.ImageUrl) ? "/images/no-image.png" : p.ImageUrl;
                        <div class="card">
                            <img src="@img" alt="@p.Name" class="thumb" />
                            <div class="body">
                                <div class="title">@p.Name</div>
                                <div class="price">@VND(p.Price)</div>
                                <div class="actions">
                                    <a asp-controller="Products" asp-action="Details" asp-route-id="@p.Id" class="btn btn-outline-secondary btn-sm">Xem chi tiết</a>
                                    <form asp-controller="Cart" asp-action="Add" method="post" class="m-0">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="productId" value="@p.Id" />
                                        <button type="submit" class="btn btn-primary btn-sm">Thêm vào giỏ</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </section>
        }
    }
</div>
